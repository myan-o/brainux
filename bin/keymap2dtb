#!/bin/bash

keymap="$1"
dtb="$2"
dts=`mktemp`
dts2=`mktemp`
dirname=${0%/*}

if [ $# -le 1 ]
then
  dtb="/boot/imx28-pwg5300.dtb"
  mount /dev/mmcblk1p1 /boot
fi


if [ -f $dtb ]
then
  dtc -I dtb -O dts $dtb > $dts 2> /dev/null
  cat $dts | ${dirname}/keymap2dts "$keymap" > $dts2
  dtc -I dts -O dtb $dts2 > $dtb 2> /dev/null
else
  echo "$dtb is not found"
fi

if [ $# -le 1 ]
then
  umount /boot
  reboot
fi
