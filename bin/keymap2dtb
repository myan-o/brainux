#!/bin/bash

keymap="$1"
dtb="/boot/imx28-pwg5300.dtb"
dts=`mktemp`
dirname=${0%/*}

mount /dev/mmcblk1p1 /boot

dtc -I dtb -O dts $dtb > $dts 2> /dev/null
cat $dts | ${dirname}/keymap2dts "$keymap" > $dts
dtc -I dts -O dtb $dts > $dtb 2> /dev/null

umount /boot
reboot
